{"version":3,"sources":["webpack:///./src/number/operators.js?7c70**"],"names":["nd","require","Number","Operators","module","exports","window","dot","nbA","nbB","sA","shape","sB","pA","space","pB","newShape","slice","concat","newValue","Float32Array","getVolume","selector","map","d","Aaxis","length","Baxis","nS","Error","px","indexGenerator","getSpace","idx","vx","adx","bdx","aV$_","reduce","s","i","bV$_","aVx","bVx","v","value","T","reverse","rvx","pow","hat","exp","Math","tanh","sigmoid","relu","a","validateOps","valB","vecMapping","ndA","ndB","ops","vA","vB","numMapping","console","warn","isNumber","add","b","addOp","d1","d2","mapping","minus","minusOp","mul","mulOp","div","divOp"],"mappings":"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","file":"hot/hot-update.js","sourcesContent":["\"use strict\";\nconst nd = require('./ndarray');\nconst Number = require('./number');\n\nconst Operators = {}\n\nif (typeof module !== 'undefined') {\n  module.exports   = Operators;\n} \nif (typeof window !== 'undefined') {\n  window.Operators = Operators;\n}\n\nOperators.dot = function(nbA,nbB){\n    const sA = nbA.shape, sB = nbB.shape;\n    const pA = nbA.space, pB = nbB.space;\n    let newShape = sA.slice(0,-1).concat( sB.slice(-1) );\n    let newValue = new Float32Array(nd.getVolume(newShape));\n    \n    const selector = newShape.map(d=>[0,d,1]);\n    const Aaxis = sA.length-1, Baxis = sB.length-2;\n    const nS = sA[Aaxis]===sB[Baxis]?sA[Aaxis]:null;\n    if(nS===null){ throw Error('shape not consitent') }\n    for(let px of nd.indexGenerator(selector, nd.getSpace(newShape) ) ){\n      let idx  = px.idx, vx = px.vx;\n      let adx  = idx.slice(), bdx = idx.slice();\n      let aV$_ = adx.reduce((s,d,i)=>(i==Aaxis)?s:s+d*pA[i], 0);\n      let bV$_ = bdx.reduce((s,d,i)=>(i==Baxis)?s:s+d*pB[i], 0);\n      let aVx  = 0, bVx = 0;\n      for(let v = 0; v < nS; v += 1){\n        aVx = aV$_ + v*pA[Aaxis];\n        bVx = bV$_ + v*pB[Baxis];\n        newValue[vx] += nbA.value[aVx]*nbB.value[bVx];\n      }\n  }\n  return Number(newValue, newShape);\n};\n\nOperators.T = (nbA)=>{\n    // validateDotShape(a.shape,b.shape);\n    const sA = nbA.shape, space = nbA.space;\n    let newShape = sA.slice().reverse();\n    let newValue = new Float32Array(nd.getVolume(newShape));\n    const selector = newShape.map(d=>[0,d,1]);\n    for( let px of nd.indexGenerator(selector, nd.getSpace(newShape)) ){\n      const idx = px.idx, vx = px.vx;\n      const rvx = idx.slice().reverse().reduce((s,d,i)=>s+d*space[i],0);\n      newValue[vx] = nbA.value[rvx];\n  }\n  return Number(newValue, newShape);\n};\n\nOperators.pow = (nd, hat)=>{\n  let newValue = nd.value.map(d=>d**(hat));\n  return Number(newValue, nd.shape);\n}\n\nOperators.exp = (nd)=>{\n  let newValue = nd.value.map(d=>Math.exp(d));\n  return Number(newValue, nd.shape);\n}\n\nOperators.tanh = (nd)=>{\n  let newValue = nd.value.map(d=>Math.tanh(d));\n  return Number(newValue, nd.shape);\n}\n\nOperators.sigmoid = (nd)=>{\n  let newValue = nd.value.map(d=>0.5*(Math.tanh(d)+1.0));\n  return Number(newValue, nd.shape);\n}\n\nOperators.relu = (a)=>{\n  throw Error('not implement');\n};\n\nconst validateOps = (nbA, valB)=>{\n  const vecMapping = (ndA, ndB, ops)=>{\n    let vA = ndA.value, vB = ndB.value;\n    return vA.map((d,i)=>ops(vA[i], vB[i]));\n  }\n\n  const numMapping = (ndA, vB, ops)=>{\n    let vA = ndA.value;\n    return vA.map((d,i)=>ops(d,vB));\n  }\n  console.warn(typeof nbA, typeof valB);\n  if( Number().isNumber(nbA) && typeof valB === 'number' ){\n    return numMapping;\n  }\n  if( Number().isNumber(nbA) && Number().isNumber(valB) ){\n    return vecMapping;\n  }\n  throw Error('invalide object type');\n}\n\nOperators.add = (a,b)=>{\n  \n  const addOp   = (d1,d2)=>d1+d2;\n  const mapping = validateOps(a,b);\n  let newValue  = mapping(a, b, addOp);\n  return Number(newValue, a.shape);\n};\n\nOperators.minus = (a,b)=>{\n  const minusOp = (d1,d2)=>d1-d2;\n  const mapping = validateOps(a,b);\n  let newValue  = mapping(a, b, minusOp);\n  return Number(newValue, a.shape);\n};\n\nOperators.mul = (a,b)=>{\n  const mulOp   = (d1,d2)=>d1*d2;\n  const mapping = validateOps(a,b);\n  let newValue  = mapping(a, b, mulOp);        \n  return Number(newValue, a.shape);  \n};\n\nOperators.div = (a,b)=>{\n  const divOp   = (d1,d2)=>d1/d2;\n  const mapping = validateOps(a,b);\n  let newValue  = mapping(a, b, divOp);     \n  return Number(newValue, a.shape);\n};\n\n\n// WEBPACK FOOTER //\n// ./src/number/operators.js"],"sourceRoot":""}