{"version":3,"sources":["webpack:///./src/number/autograd/gradOps.js?51bc"],"names":["Number","require","nd","Operators","Op","GradOps","module","exports","window","tanh","ret","grad","vjp_op","x","Math","pow","bw","vid","elementWise","vjp","value","map","d","shape","add","nds","i","filter","minus","dot","nbs","nd0_grad","nd$0","sR","s$0","pR","space","p$0","length","nd1_grad","nd$1","s$1","transformRet","nb$0","nb$1","rS","nb$0Shape","nb$1Shape","leftSelector","rightSelector","slice","selector","px","nb","inbexGenerator","getSpace","nb0_grad","nb1_grad","hat","pow_grad","bwGrad","mul","mean","axis","_length"],"mappings":";;;;;AAAA,MAAMA,SAAS,mBAAAC,CAAQ,CAAR,CAAf;AACA,MAAMC,KAAK,mBAAAD,CAAQ,CAAR,CAAX;AACA,MAAME,YAAY,mBAAAF,CAAQ,CAAR,CAAlB;AACA,MAAMG,KAAKD,SAAX;AACA,MAAME,UAAU,EAAhB;;AAEA,IAAI,IAAJ,EAAmC;AACjCC,SAAOC,OAAP,GAAkBF,OAAlB;AACD;AACD,IAAI,OAAOG,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,SAAOH,OAAP,GAAkBA,OAAlB;AACD;;AAGDA,QAAQI,IAAR,GAAe,CAACC,GAAD,EAAMR,EAAN,KAAW;AACxB,MAAGA,GAAGS,IAAN,EAAW;AACP,UAAMC,SAAUC,CAAD,IAAK,IAAIC,KAAKC,GAAL,CAASD,KAAKL,IAAL,CAAUI,CAAV,CAAT,EAAsB,CAAtB,CAAxB;AACAH,QAAIC,IAAJ,GAAW,CAAC,EAAEK,IAAId,EAAN,EAAUe,KAAKf,GAAGS,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BC,aAAa,IAA5C;AACEC,WAAKnB,OAAOE,GAAGkB,KAAH,CAASC,GAAT,CAAaC,KAAGV,OAAOU,CAAP,CAAhB,CAAP,EAAmCpB,GAAGqB,KAAtC,CADP,EAAD,CAAX;AAEH;AACD,SAAOb,GAAP;AACD,CAPD;;AASAL,QAAQmB,GAAR,GAAc,CAACd,GAAD,EAAMe,GAAN,KAAY;AACxBf,MAAIC,IAAJ,GAAWc,IAAIJ,GAAJ,CAAQ,CAACnB,EAAD,EAAIwB,CAAJ,KAAQ;AAC1B,QAAGxB,GAAGS,IAAN,EAAW;AACT,aAAO,EAAEK,IAAId,EAAN,EAAUe,KAAKf,GAAGS,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BC,aAAa,IAA5C;AACEC,aAAKnB,OAAOE,GAAGkB,KAAH,CAASC,GAAT,CAAaC,KAAG,CAAhB,CAAP,EAA2BpB,GAAGqB,KAA9B,CADP,EAAP;AAED;AACA,GALS,EAMTI,MANS,CAMFL,KAAGA,CAND,CAAX;AAOA,SAAOZ,GAAP;AACD,CATD;;AAWAL,QAAQuB,KAAR,GAAgB,CAAClB,GAAD,EAAMe,GAAN,KAAY;AAC1Bf,MAAIC,IAAJ,GAAWc,IAAIJ,GAAJ,CAAQ,CAACnB,EAAD,EAAIwB,CAAJ,KAAQ;AAC1B,QAAGxB,GAAGS,IAAH,IAAWe,KAAK,CAAnB,EAAqB;AACnB,aAAO,EAAEV,IAAId,EAAN,EAAUe,KAAKf,GAAGS,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BC,aAAa,IAA5C;AACEC,aAAKnB,OAAOE,GAAGkB,KAAH,CAASC,GAAT,CAAaC,KAAG,CAAhB,CAAP,EAA2BpB,GAAGqB,KAA9B,CADP,EAAP;AAED;AACD,QAAGrB,GAAGS,IAAH,IAAWe,KAAK,CAAnB,EAAqB;AACnB,aAAO,EAAEV,IAAId,EAAN,EAAUe,KAAKf,GAAGS,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BC,aAAa,IAA5C;AACEC,aAAKnB,OAAOE,GAAGkB,KAAH,CAASC,GAAT,CAAaC,KAAG,CAAC,CAAjB,CAAP,EAA4BpB,GAAGqB,KAA/B,CADP,EAAP;AAED;AACA,GATS,EAUTI,MAVS,CAUFL,KAAGA,CAVD,CAAX;AAWA,SAAOZ,GAAP;AACD,CAbD;;AAeAL,QAAQwB,GAAR,GAAc,CAACnB,GAAD,EAAMoB,GAAN,KAAY;AACxB,QAAMC,WAAW,CAACrB,GAAD,EAAMsB,IAAN,KAAa;AAC5B,QAAIC,KAAKvB,IAAIa,KAAb;AAAA,QAAoBW,MAAMF,KAAKT,KAA/B;AACA,QAAIY,KAAKzB,IAAI0B,KAAb;AAAA,QAAoBC,MAAML,KAAKI,KAA/B;AACA,QAAGF,IAAII,MAAJ,IAAc,CAAjB,EAAmB,CAElB,CAFD,MAGK,IAAGJ,IAAII,MAAJ,IAAc,CAAjB,EAAmB,CAEvB,CAFI,MAGA,IAAGJ,IAAII,MAAJ,GAAa,CAAhB,EAAkB,CAEtB;AACF,GAZD;AAaA,QAAMC,WAAW,CAAC7B,GAAD,EAAM8B,IAAN,KAAa;AAC5B,QAAIP,KAAKvB,IAAIa,KAAb;AAAA,QAAoBW,MAAMM,KAAKjB,KAA/B;AACA,QAAIY,KAAKzB,IAAI0B,KAAb;AAAA,QAAoBC,MAAMG,KAAKJ,KAA/B;AACA,QAAGK,IAAIH,MAAJ,IAAc,CAAjB,EAAmB,CAElB,CAFD,MAGK,IAAGG,IAAIH,MAAJ,IAAc,CAAjB,EAAmB,CAEvB,CAFI,MAGA,IAAGG,IAAIH,MAAJ,GAAa,CAAhB,EAAkB,CAEtB;AACF,GAZD;AAaA,QAAMI,eAAe,CAAChC,GAAD,EAAMiC,IAAN,EAAYC,IAAZ,KAAmB;AACtC,QAAIC,KAAKnC,IAAIa,KAAb;AAAA,QAAoBuB,YAAYH,KAAKpB,KAArC;AAAA,QACIwB,YAAYH,KAAKrB,KADrB;AAEA,QAAIyB,YAAJ,EAAkBC,aAAlB;AACA,QAAGH,UAAUR,MAAV,GAAmB,CAAtB,EAAwB;AACtBU,qBAAeL,KAAKpB,KAAL,CAAW2B,KAAX,CAAiB,CAAjB,EAAmB,CAAC,CAApB,CAAf;AACD;AACD,QAAGH,UAAUT,MAAV,GAAmB,CAAtB,EAAwB;AACtBW,sBAAgBN,KAAKpB,KAAL,CAAW2B,KAAX,CAAiB,CAAjB,EAAmB,CAAC,CAApB,CAAhB;AACD;AACDC,eAAYH,eAAgBtC,IAAIa,KAAJ,CAAU2B,KAAV,CAAgB,CAAC,CAAjB,CAAhB,GACAD,aADA,GACgBvC,IAAIa,KAAJ,CAAU2B,KAAV,CAAgB,CAAC,CAAjB,CAD5B;AAEA,SAAI,IAAIE,EAAR,IAAcC,GAAGC,cAAH,CAAkBH,QAAlB,EAA4BE,GAAGE,QAAH,EAA5B,CAAd,EACA,OAAO7C,GAAP;AACD,GAdD;AAeAA,MAAIgC,YAAJ,GAAmBA,YAAnB;AACAhC,MAAIC,IAAJ,GAAWmB,IAAIT,GAAJ,CAAQ,CAACgC,EAAD,EAAI3B,CAAJ,KAAQ;AAC1B,QAAG2B,GAAG1C,IAAN,EAAW;AACV,UAAGe,KAAK,CAAR,EAAU;AACP,eAAO,CAAC,EAAEV,IAAIqC,EAAN,EAAUpC,KAAKoC,GAAG1C,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BE,KAAKqC,QAApC,EAAD,CAAP;AACD,OAFF,MAGK;AACF,eAAO,CAAC,EAAExC,IAAIqC,EAAN,EAAUpC,KAAKoC,GAAG1C,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BE,KAAKsC,QAApC,EAAD,CAAP;AACD;AACF;AACA,GATS,EAUT9B,MAVS,CAUFL,KAAGA,CAVD,CAAX;AAWA,SAAOZ,GAAP;AACD,CAvDD;;AAyDAL,QAAQU,GAAR,GAAc,CAACL,GAAD,EAAM2C,EAAN,EAAUK,GAAV,KAAgB;AAC5B,MAAGL,GAAG1C,IAAN,EAAW;AACP,UAAMgD,WAAW,CAACC,MAAD,EAASP,EAAT,KAAc;AAC7B,aAAOjD,GAAGyD,GAAH,CAAQD,MAAR,EAAgBxD,GAAGyD,GAAH,CAAOR,EAAP,EAAWK,GAAX,CAAhB,CAAP;AACD,KAFD;AAGAhD,QAAIC,IAAJ,GAAW,CAAC,EAAEK,IAAIqC,EAAN,EAAUpC,KAAKoC,GAAG1C,IAAH,CAAQ,CAAR,EAAWM,GAA1B,EAA+BE,KAAKwC,QAApC,EAAD,CAAX;AACH;AACD,SAAOjD,GAAP;AACD,CARD;;AAUAL,QAAQyD,IAAR,GAAe,CAACpD,GAAD,EAAM2C,EAAN,EAAUU,IAAV,KAAiB;AAC9B,MAAGV,GAAG1C,IAAN,EAAW;AACPD,QAAIC,IAAJ,GAAW,CAAC,EAAEK,IAAIqC,EAAN,EAAUpC,KAAKoC,GAAG1C,IAAH,CAAQ,CAAR,EAAWM,GAA1B;AACEE,WAAK,CAACyC,MAAD,EAASP,EAAT,KAAc;AACjB,cAAMW,UAAUX,GAAGjC,KAAH,CAASkB,MAAzB;AACA,cAAM1B,SAAUC,CAAD,IAAM,MAAImD,OAAzB;AACA,eAAOhE,OAAOqD,GAAGjC,KAAH,CAASC,GAAT,CAAaC,KAAGV,OAAOU,CAAP,CAAhB,CAAP,EAAmC+B,GAAG9B,KAAtC,CAAP;AACD,OALH,EAAD,CAAX;AAMH;AACD,SAAOb,GAAP;AACD,CAVD,C","file":"hot/hot-update.js","sourcesContent":["const Number = require('../number');\nconst nd = require('../ndarray');\nconst Operators = require('../operators');\nconst Op = Operators;\nconst GradOps = {};\n\nif (typeof module !== 'undefined') {\n  module.exports  = GradOps;\n} \nif (typeof window !== 'undefined') {\n  window.GradOps  = GradOps;\n}\n\n\nGradOps.tanh = (ret, nd)=>{\n  if(nd.grad){\n      const vjp_op = (x)=>1 - Math.pow(Math.tanh(x),2);\n      ret.grad = [{ bw: nd, vid: nd.grad[0].vid, elementWise: true,\n                    vjp: Number(nd.value.map(d=>vjp_op(d)), nd.shape)} ]\n  }\n  return ret;\n}\n\nGradOps.add = (ret, nds)=>{\n  ret.grad = nds.map((nd,i)=>{\n\t\t\tif(nd.grad){\n\t\t\t  return { bw: nd, vid: nd.grad[0].vid, elementWise: true,\n\t\t\t           vjp: Number(nd.value.map(d=>1), nd.shape)}\n\t\t\t}\n\t  })\n\t  .filter(d=>d);\t\n  return ret;\n}\n\nGradOps.minus = (ret, nds)=>{\n  ret.grad = nds.map((nd,i)=>{\n\t\t\tif(nd.grad && i == 0){\n\t\t\t  return { bw: nd, vid: nd.grad[0].vid, elementWise: true,\n\t\t\t           vjp: Number(nd.value.map(d=>1), nd.shape)}\n\t\t\t}\n\t\t\tif(nd.grad && i == 1){\n\t\t\t  return { bw: nd, vid: nd.grad[0].vid, elementWise: true,\n\t\t\t           vjp: Number(nd.value.map(d=>-1), nd.shape)}\n\t\t\t}\n\t  })\n\t  .filter(d=>d);\t\n  return ret;\n}\n\nGradOps.dot = (ret, nbs)=>{\n  const nd0_grad = (ret, nd$0)=>{\n    let sR = ret.shape, s$0 = nd$0.shape;\n    let pR = ret.space, p$0 = nd$0.space;\n    if(s$0.length == 1){\n\n    }\n    else if(s$0.length == 2){\n\n    }\n    else if(s$0.length > 2){\n\n    }\n  }\n  const nd1_grad = (ret, nd$1)=>{\n    let sR = ret.shape, s$0 = nd$1.shape;\n    let pR = ret.space, p$0 = nd$1.space;\n    if(s$1.length == 1){\n\n    }\n    else if(s$1.length == 2){\n\n    }\n    else if(s$1.length > 2){\n\n    }\n  }\n  const transformRet = (ret, nb$0, nb$1)=>{\n    let rS = ret.shape, nb$0Shape = nb$0.shape, \n        nb$1Shape = nb$1.shape;\n    let leftSelector, rightSelector;\n    if(nb$0Shape.length > 2){\n      leftSelector = nb$0.shape.slice(0,-2);\n    }\n    if(nb$1Shape.length > 2){\n      rightSelector = nb$0.shape.slice(0,-2);\n    }\n    selector =  leftSelector  + ret.shape.slice(-2)\n              + rightSelector + ret.shape.slice(-1);  \n    for(let px of nb.inbexGenerator(selector, nb.getSpace()))\n    return ret;\n  }\n  ret.transformRet = transformRet;\n  ret.grad = nbs.map((nb,i)=>{\n\t\t\tif(nb.grad){\n\t\t\t\tif(i == 0){\n\t\t\t    return [{ bw: nb, vid: nb.grad[0].vid, vjp: nb0_grad }];\n\t\t\t  }\n\t\t\t  else{\n\t\t\t    return [{ bw: nb, vid: nb.grad[0].vid, vjp: nb1_grad }];\n\t\t\t  }\n\t\t\t}\n\t  })\n\t  .filter(d=>d);\t\n  return ret;\n}\n\nGradOps.pow = (ret, nb, hat)=>{\n  if(nb.grad){\n      const pow_grad = (bwGrad, nb)=>{\n        return Op.mul( bwGrad, Op.mul(nb, hat) )\n      }\n      ret.grad = [{ bw: nb, vid: nb.grad[0].vid, vjp: pow_grad }];\n  }\n  return ret;\n}\n\nGradOps.mean = (ret, nb, axis)=>{\n  if(nb.grad){\n      ret.grad = [{ bw: nb, vid: nb.grad[0].vid, \n                    vjp: (bwGrad, nb)=>{\n                      const _length = nb.value.length;\n                      const vjp_op = (x)=> 1.0/_length;\n                      return Number(nb.value.map(d=>vjp_op(d)), nb.shape)\n                    } }];\n  }\n  return ret;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/number/autograd/gradOps.js"],"sourceRoot":""}