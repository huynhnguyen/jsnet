{"version":3,"sources":["webpack:///./src/number/autograd/autograd.js?00d0"],"names":["nd","require","Ops","Number","console","warn","Autograd","module","exports","window","backward","nd$child","nd$pDiff","grad","map","g","bw","vjp","nd$diff","dot","T","filter","d","func","wrapper","inputs","nd$0","c","enummerate","isNumber","vid","nd$ret","value","nd$grad"],"mappings":";;;;;;AAAA;;AACA,MAAMA,KAAK,mBAAAC,CAAQ,CAAR,CAAX;AACA,MAAMC,MAAO,mBAAAD,CAAQ,CAAR,CAAb;AACA,MAAME,SAAS,mBAAAF,CAAQ,CAAR,CAAf;;AAEAG,QAAQC,IAAR,CAAaH,GAAb;;AAEA,MAAMI,WAAW,EAAjB;;AAEA,IAAI,IAAJ,EAAmC;AACjCC,QAAOC,OAAP,GAAmBF,QAAnB;AACD;AACD,IAAI,OAAOG,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,QAAOH,QAAP,GAAkBA,QAAlB;AACD;;AAED;AACA;AACA;AACA,MAAMI,WAAW,CAACC,QAAD,EAAWC,QAAX,KAAsB;AACtC,OAAMC,OAAOF,SAASE,IAAtB;AACA;AACA,KAAGA,QAAQ,IAAX,EAAgB;AACf,SAAOD,QAAP;AACA,EAFD,MAGI;AACH,SAAQC,KAAKC,GAAL,CAAUC,KAAK;AACpB,OAAGA,MAAI,KAAP,EAAa;AAAE,WAAO,IAAP;AAAa;AAC5B,OAAGA,EAAEC,EAAF,KAAO,IAAP,IAAeD,EAAEE,GAAF,KAAQ,IAA1B,EAA+B;AAC9B,WAAOL,QAAP;AACA,IAFD,MAEK;AACJ,QAAIM,UAAUhB,IAAIiB,GAAJ,CAAQjB,IAAIkB,CAAJ,CAAMR,QAAN,CAAR,EAAwBG,EAAEE,GAA1B,CAAd;AACA;AACA;AACA;AACA;AACA,WAAOP,SAASK,EAAEC,EAAX,EAAeE,OAAf,CAAP;AACA;AACD,GAZK,EAaLG,MAbK,CAaEC,KAAGA,CAbL,CAAR;AAcA;AACD,CAtBD;;AAwBAhB,SAASO,IAAT,GAAgB,UAASU,IAAT,EAAc;AAC7B,OAAMC,UAAU,CAAC,GAAGC,MAAJ,KAAa;AAC5B,OAAK,IAAI,CAACC,IAAD,EAAOC,CAAP,CAAT,IAAsB3B,GAAG4B,UAAH,CAAcH,MAAd,CAAtB,EAA8C;AAC7C,OAAGtB,SAAS0B,QAAT,CAAkBH,IAAlB,KAA2BA,KAAKb,IAAL,KAAc,KAA5C,EAAkD;AACjDa,SAAKb,IAAL,GAAY,CAAC,EAAEiB,KAAKH,CAAP,EAAUX,IAAI,IAAd,EAAoBC,KAAI,IAAxB,EAAD,CAAZ;AACA;AACD;AACD,MAAIc,SAAUR,KAAK,GAAGE,MAAR,CAAd;AACA;AACAM,SAAOC,KAAP,GAAeD,OAAOC,KAAP,CAAalB,GAAb,CAAiBQ,KAAG,CAApB,CAAf;AACA,MAAIW,UAAUvB,SAAUqB,MAAV,EAAkBA,MAAlB,CAAd;AACA,SAAO,CAACE,OAAD,EAAUF,MAAV,CAAP;AACA,EAXD;AAYA,QAAOP,OAAP;AACA,CAdD;;AAgBAlB,SAASI,QAAT,GAAoBA,QAApB,C","file":"hot/hot-update.js","sourcesContent":["\"use strict\";\nconst nd = require('../ndarray');\nconst Ops  = require('../operators');\nconst Number = require('../number');\n\nconsole.warn(Ops);\n\nconst Autograd = {};\n\nif (typeof module !== 'undefined') {\n  module.exports   = Autograd;\n} \nif (typeof window !== 'undefined') {\n  window.Autograd = Autograd;\n}\n\n// for(let func in Ops){\n// \tconsole.warn(func);\n// }\nconst backward = (nd$child, nd$pDiff)=>{\n\tconst grad = nd$child.grad;\n\t// console.group(nd$child, nd$pDiff);\n\tif(grad == null){\n\t\treturn nd$pDiff;\n\t}\t\n\telse{\n\t\treturn  grad.map( g => {\n\t\t\t\t\tif(g===false){ return null }\n\t\t\t\t\tif(g.bw===null || g.vjp===null){\n\t\t\t\t\t\treturn nd$pDiff;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tlet nd$diff = Ops.dot(Ops.T(nd$pDiff),g.vjp);\n\t\t\t\t\t\t// console.warn('[backward] g');\n\t\t\t\t\t\t// console.table( g );\n\t\t\t\t\t\t// console.warn('[backward] nd$diff');\n\t\t\t\t\t\t// console.table( nd$diff );\n\t\t\t\t\t\treturn backward(g.bw, nd$diff);\t\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t\t.filter(d=>d);\n\t}\n}\n\nAutograd.grad = function(func){\n\tconst wrapper = (...inputs)=>{\n\t\tfor( let [nd$0, c] of nd.enummerate(inputs) ) {\n\t\t\tif(Number().isNumber(nd$0) && nd$0.grad !== false){\n\t\t\t\tnd$0.grad = [{ vid: c, bw: null, vjp:null}];\n\t\t\t}\n\t\t}\n\t\tlet nd$ret  = func(...inputs);\n\t\t//reset value to 1\n\t\tnd$ret.value = nd$ret.value.map(d=>1);\n\t\tlet nd$grad = backward( nd$ret, nd$ret );\n\t\treturn [nd$grad, nd$ret];\n\t}\n\treturn wrapper;\n}\n\nAutograd.backward = backward;\n\n\n// WEBPACK FOOTER //\n// ./src/number/autograd/autograd.js"],"sourceRoot":""}